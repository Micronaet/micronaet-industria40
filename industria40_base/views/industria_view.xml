<?xml version="1.0"?>
<openerp>
    <data>
        <!--stock.picking-->
        <record model="ir.ui.view" id="view_stock_picking_cl_form">
            <field name="name">stock.picking.cl.mrp.lavoration.form</field>
            <field name="model">stock.picking</field>
            <field name="priority" eval="50" />
            <field name="inherit_id" ref="lavoration_cl_sl.view_stock_picking_cl_form"/>
            <field name="arch" type="xml">
                <xpath expr="//page" position="after">
                    <page string="Industria 4.0: Job" attrs="{'invisible': [('job_ids', '=', [])]}">
                        <group col="4" colspan="4">
                            <separator string="Job" colspan="4"/>
                            <field name="job_ids"  colspan="4" nolabel="1" readonly="1" editable="bottom">
                            </field>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!--industria.database-->
        <record model="ir.ui.view" id="view_industria_database_form">
            <field name="name">industria.database.form</field>
            <field name="model">industria.database</field>
            <field name="arch" type="xml">
                <form string="Database" version="7.0">
                    <header>
                        <button name="test_database_connection" type="object" string="Test" icon="gtk-refresh" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                        <button name="import_program" type="object" string="Import program" icon="terp-calendar" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                        <button name="import_robot" type="object" string="Import robot" icon="gtk-network" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                        <button name="import_job" type="object" string="Import jobs" icon="gtk-justify-fill"/>
                        <button name="generate_picking_from_job" type="object" string="Generate picking" icon="STOCK_EXECUTE"/>
                    </header>
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="name" />
                            <field name="partner_id" required="1"/>

                            <field name="ip" />
                            <field name="username" attrs="{'required': [('mode', '!=', 'ftp')], 'invisible': [('mode', '=', 'ftp')]}"/>
                            <field name="password" password="True" attrs="{'required': [('mode', '!=', 'ftp')], 'invisible': [('mode', '=', 'ftp')]}"/>

                            <field name="database" attrs="{'required': [('mode', '!=', 'ftp')], 'invisible': [('mode', '=', 'ftp')]}"/>
                            <field name="port" attrs="{'required': [('mode', '!=', 'ftp')], 'invisible': [('mode', '=', 'ftp')]}" />

                            <field name="mode" />
                            <field name="ftp_command" colspan="4"  attrs="{'required': [('mode', '=', 'ftp')], 'invisible': [('mode', '!=', 'ftp')]}"/>
                            <field name="ftp_fullname" colspan="4"  attrs="{'required': [('mode', '=', 'ftp')], 'invisible': [('mode', '!=', 'ftp')]}"/>

                            <separator string="Note" colspan="4"/>
                            <field name="note" colspan="4" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_database_tree">
            <field name="name">industria.database.tree</field>
            <field name="model">industria.database</field>
            <field name="arch" type="xml">
                <tree string="Database">
                    <field name="name" />
                    <field name="ip" />
                    <field name="mode" />

                    <field name="username" />

                    <field name="database" />
                    <field name="port" />
                    <button name="test_database_connection" type="object" string="Test" icon="gtk-refresh" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                    <button name="import_program" type="object" string="Import program" icon="terp-calendar" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                    <button name="import_robot" type="object" string="Import robot" icon="gtk-network" attrs="{'invisible': [('mode', '=', 'ftp')]}"/>
                    <button name="import_job" type="object" string="Import jobs" icon="gtk-justify-fill"/>
                    <button name="generate_picking_from_job" type="object" string="Generate picking" icon="STOCK_EXECUTE"/>
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_database">
            <field name="name">Database</field>
            <field name="res_model">industria.database</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_industria_database_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--industria.robot-->
        <record model="ir.ui.view" id="view_industria_robot_form">
            <field name="name">industria.robot.form</field>
            <field name="model">industria.robot</field>
            <field name="arch" type="xml">
                <form string="Database" version="7.0">
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="ip" />
                            <field name="name" />

                            <field name="partner_id" />
                            <field name="database_id" />

                            <field name="industria_ref" />

                            <notebook colspan="4">
                                <page name="program_page" string="Program">
                                    <group colspan="4" col="4">
                                        <separator string="Program" colspan="4"/>
                                        <field name="program_ids" colspan="4" nolabel="1"/>
                                    </group>
                                </page>
                                <!--<page name="state_page" string="Status">
                                    <group colspan="4" col="4">
                                        <separator string="Today status" colspan="4"/>
                                        <field name="today_state" colspan="4" nolabel="1" widget="html"/>
                                    </group>
                                </page>-->
                                <page name="note_page" string="Note">
                                    <group colspan="4" col="4">
                                        <separator string="Note" colspan="4"/>
                                        <field name="note" colspan="4" nolabel="1"/>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_robot_tree">
            <field name="name">industria.robot.tree</field>
            <field name="model">industria.robot</field>
            <field name="arch" type="xml">
                <tree string="Database">
                    <field name="ip" />
                    <field name="name" />
                    <field name="partner_id" />
                    <field name="database_id" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_robot">
            <field name="name">Robot</field>
            <field name="res_model">industria.robot</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_industria_robot_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--industria.program-->
        <record model="ir.ui.view" id="view_industria_program_form">
            <field name="name">industria.program.form</field>
            <field name="model">industria.program</field>
            <field name="arch" type="xml">
                <form string="Program" version="7.0">
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="code" />
                            <field name="name" />

                            <field name="industria_ref" />
                            <field name="timeout" />

                            <field name="piece" />
                            <field name="source_id" />

                            <field name="partner_id" />
                            <field name="database_id" />

                            <field name="product_id" required="1"/>

                            <separator string="Note" colspan="4"/>
                            <field name="note" colspan="4" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_program_tree">
            <field name="name">industria.program.tree</field>
            <field name="model">industria.program</field>
            <field name="arch" type="xml">
                <tree string="Database" colors="red:product_id == False or source_id == False">
                    <field name="code" />
                    <field name="name" />

                    <field name="industria_ref" />
                    <field name="timeout" />

                    <field name="piece" />
                    <field name="source_id" />
                    <field name="product_id" />

                    <field name="partner_id" />
                    <field name="database_id" />

                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_program">
            <field name="name">Program</field>
            <field name="res_model">industria.program</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_industria_program_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <!--industria.job-->
        <record model="ir.ui.view" id="view_industria_job_graph">
            <field name="name">industria.job.graph</field>
            <field name="model">industria.job</field>
            <field name="type">graph</field>
            <field name="arch" type="xml">
                <graph string="Industria" type="bar">
                    <field name="source_id"/>
                    <field name="job_duration" operator="+"/>
                </graph>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_job_search">
            <field name="name">industria.job.search</field>
            <field name="model">industria.job</field>
            <field name="arch" type="xml">
                <search string="Jobs" version="7.0">
                    <field name="database_id" />
                    <field name="program_id" />
                    <field name="source_id" />

                    <field name="partner_id" filter_domain="[('partner_id','=',self)]"/>

                    <filter name="state_error" string="Error state" domain="[('state','=','ERROR')]"/>
                    <filter name="state_error" string="Running state" domain="[('state','=','RUNNING')]"/>
                    <filter name="state_error" string="Completed state" domain="[('state','=','COMPLETED')]"/>

                    <filter name="state_anomaly" string="Anomaly state" domain="['|',('state','=','ERROR'),('job_duration', '&gt;', 10)]"/>

                    <group expand="0" string="Group By...">
                        <filter name="group_partner" string="Partner" context="{'group_by': 'partner_id'}"/>
                        <filter string="Create" context="{'group_by': 'created_at:day'}" />
                        <filter string="Ended" context="{'group_by': 'ended_at:day'}" />
                        <filter string="Update" context="{'group_by': 'updated_at:day'}" />

                        <!--<filter string="Create" context="{'group_by': 'created_at'}" />
                        <filter string="Ended" context="{'group_by': 'ended_at'}" />
                        <filter string="Update" context="{'group_by': 'updated_at'}" />-->

                        <filter string="Database" context="{'group_by': 'database_id'}" />
                        <filter string="Program" context="{'group_by': 'program_id'}" />
                        <filter string="Robot" context="{'group_by': 'source_id'}" />
                        <filter string="Status" context="{'group_by': 'state'}" />
                    </group>
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_job_form">
            <field name="name">industria.job.form</field>
            <field name="model">industria.job</field>
            <field name="arch" type="xml">
                <form string="Job" version="7.0">
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="dismiss" />
                            <field name="job_duration" widget="float_time"/>

                            <field name="created_at" />
                            <field name="ended_at" />

                            <field name="updated_at" />

                            <field name="database_id" />
                            <field name="industria_ref" />

                            <field name="program_id" />
                            <field name="source_id" />

                            <field name="partner_id" />
                            <field name="state" />

                            <field name="picking_id" readonly="1" />
                            <field name="unused" attrs="{'invisible': [('picking_id', '!=', False)]}"/>

                            <separator string="Note" colspan="4"/>
                            <field name="notes" colspan="4" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_industria_job_tree">
            <field name="name">industria.job.tree</field>
            <field name="model">industria.job</field>
            <field name="arch" type="xml">
                <tree string="Job" colors="red:state=='ERROR' OR dismiss==True;blue:state=='RUNNING'">
                    <field name="dismiss" />
                    <field name="created_at" />
                    <field name="ended_at" />
                    <field name="updated_at" />
                    <field name="job_duration" widget="float_time" sum="total"/>

                    <field name="database_id" />
                    <field name="industria_ref" />

                    <field name="program_id" />
                    <field name="source_id" />

                    <field name="partner_id" />
                    <field name="picking_id" />
                    <field name="unused" />

                    <field name="state" />
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_job">
            <field name="name">Job</field>
            <field name="res_model">industria.job</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="view_industria_job_tree"/>
            <field name="context">{}</field>
            <field name="domain">[('dismiss', '=', False)]</field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_job_anomaly">
            <field name="name">Job anomaly</field>
            <field name="res_model">industria.job</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="view_industria_job_tree"/>
            <field name="context">{'search_default_state_anomaly': True}</field>
            <field name="domain">[]</field>
        </record>
        <record model="ir.actions.act_window" id="action_industria_job_dismissed">
            <field name="name">Job dismissed</field>
            <field name="res_model">industria.job</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="view_id" ref="view_industria_job_tree"/>
            <field name="context">{}</field>
            <field name="domain">[('dismiss', '=', True)]</field>
        </record>

        <!--res.partner-->
        <record model="ir.ui.view" id="view_res_partner_industria_form">
            <field name="name">res.partner.form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <xpath expr="//page[1]" position="after">
                    <page string="Industria 4.0" attrs="{'invisible': [('source_ids','!=',False)]}" groups="industria40_base.group_industria_manager,industria40_base.group_industria_user">
                        <separator string="Robots:" colspan="4"/>
                        <field name="source_ids" />
                    </page>
                </xpath>
            </field>
        </record>

        <menuitem
            id="menu_industria_root"
            name="Industria 4.0"
            groups="industria40_base.group_industria_manager,industria40_base.group_industria_user"
            sequence="50"
            />
            <menuitem
                parent="menu_industria_root"
                id="menu_industria_master_data"
                name="Master data"
                sequence="10"
                />
                <menuitem
                    parent="menu_industria_master_data"
                    id="menu_industria_job"
                    action="action_industria_job"
                    sequence="10"
                    />
                <menuitem
                    parent="menu_industria_job"
                    id="menu_industria_job_dismissed"
                    action="action_industria_job_dismissed"
                    sequence="20"
                    />

                <menuitem
                    parent="menu_industria_master_data"
                    id="menu_industria_job_anomaly"
                    action="action_industria_job_anomaly"
                    sequence="20"
                    />

            <menuitem
                parent="menu_industria_root"
                id="menu_industria_configuration"
                name="Configuration"
                sequence="99"
                />
                <menuitem
                    parent="menu_industria_configuration"
                    id="menu_industria_robot"
                    action="action_industria_robot"
                    sequence="10"
                    />
                <menuitem
                    parent="menu_industria_configuration"
                    id="menu_industria_program"
                    action="action_industria_program"
                    sequence="20"
                    />
                <menuitem
                    parent="menu_industria_configuration"
                    id="menu_industria_database"
                    action="action_industria_database"
                    sequence="30"
                    />
    </data>
</openerp>

